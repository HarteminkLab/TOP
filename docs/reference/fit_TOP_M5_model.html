<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Fits TOP model with M5 bins — fit_TOP_M5_model • TOP</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Fits TOP model with M5 bins — fit_TOP_M5_model"><meta property="og:description" content="Fits TOP model with M5 bins.
By default, it runs Gibbs sampling for all 10 partitions
in parallel on 10 CPU cores, and returns a list of posterior samples
for each of the 10 partitions.
Alternatively, you may fit model for each of the 10
the partitions on separate machines by specifying which partition to run."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">TOP</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Tutorials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/data_preparation.html">Prepare input data</a>
    </li>
    <li>
      <a href="../articles/predict_TF_occupancy_with_trained_model.html">Predict TF occupancy using trained TOP model</a>
    </li>
    <li>
      <a href="../articles/train_TOP_model.html">Train TOP quantitative occupancy model</a>
    </li>
    <li>
      <a href="../articles/train_TOP_logistic_model.html">Train TOP logistic (binary binding) model</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/HarteminkLab/TOP/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Fits TOP model with M5 bins</h1>
    <small class="dont-index">Source: <a href="https://github.com/HarteminkLab/TOP/blob/HEAD/R/fit_models.R" class="external-link"><code>R/fit_models.R</code></a></small>
    <div class="hidden name"><code>fit_TOP_M5_model.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Fits TOP model with M5 bins.
By default, it runs Gibbs sampling for all 10 partitions
in parallel on 10 CPU cores, and returns a list of posterior samples
for each of the 10 partitions.
Alternatively, you may fit model for each of the 10
the partitions on separate machines by specifying which partition to run.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">fit_TOP_M5_model</span><span class="op">(</span></span>
<span>  <span class="va">all_training_data</span>,</span>
<span>  <span class="va">all_training_data_files</span>,</span>
<span>  <span class="va">model_file</span>,</span>
<span>  logistic_model <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  transform <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"asinh"</span>, <span class="st">"log2"</span>, <span class="st">"sqrt"</span>, <span class="st">"none"</span><span class="op">)</span>,</span>
<span>  partitions <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span>,</span>
<span>  n_iter <span class="op">=</span> <span class="fl">2000</span>,</span>
<span>  n_burnin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">n_iter</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span>,</span>
<span>  n_chains <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  n_thin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="op">(</span><span class="va">n_iter</span> <span class="op">-</span> <span class="va">n_burnin</span><span class="op">)</span><span class="op">/</span><span class="fl">1000</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  n_cores <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">partitions</span><span class="op">)</span>,</span>
<span>  save <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  outdir <span class="op">=</span> <span class="st">"TOP_fit"</span>,</span>
<span>  return_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"samples"</span>, <span class="st">"jagsfit"</span>, <span class="st">"samplefiles"</span><span class="op">)</span>,</span>
<span>  quiet <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>all_training_data</dt>
<dd><p>A list of the assembled training data of all partitions.</p></dd>


<dt>all_training_data_files</dt>
<dd><p>A vector of the assembled training data
files of all partitions. If <code>all_training_data</code> is missing,
it will load the training data from <code>all_training_data_files</code>.</p></dd>


<dt>model_file</dt>
<dd><p>TOP model file written in <code>JAGS</code>.
By default, use the model file included in the TOP package.</p></dd>


<dt>logistic_model</dt>
<dd><p>Logical; whether to use the logistic version of TOP model.
If <code>logistic_model = TRUE</code>, use the logistic version of TOP model.
If <code>logistic_model = FALSE</code>, use the quantitative occupancy model (default).</p></dd>


<dt>transform</dt>
<dd><p>Type of transformation for ChIP-seq read counts.
Options are: ‘asinh’(asinh transformation),
‘log2’ (log2 transformation),
‘sqrt’ (square root transformation),
and ‘none’(no transformation).
This only applies when <code>logistic_model = FALSE</code>.</p></dd>


<dt>partitions</dt>
<dd><p>A vector of selected partition(s) to run.
Default: all 10 partitions. If you specify a few partitions,
it will only fit models to data in those selected partitions.</p></dd>


<dt>n_iter</dt>
<dd><p>Number of total iterations per chain, including burn-in iterations.</p></dd>


<dt>n_burnin</dt>
<dd><p>Length of burn-in iterations,
i.e. number of samples to discard at the beginning.
Default is <code>n_iter/2</code>, discarding the first half of the samples.</p></dd>


<dt>n_chains</dt>
<dd><p>Number of Markov chains (default: 3).</p></dd>


<dt>n_thin</dt>
<dd><p>Thinning rate, must be a positive integer.
Default is <code>max(1, floor(n_chains * (n_iter-n_burnin) / 1000))</code>
which will only thin if there are at least 2000 simulations.
No thinning will be performed if <code>n_thin = 1</code>.</p></dd>


<dt>n_cores</dt>
<dd><p>Number of cores to use in parallel
(default: equal to the number of partitions, i.e. <code>length(partitions)</code>).</p></dd>


<dt>save</dt>
<dd><p>Logical, if TRUE, saves posterior samples as ‘.rds’ files
in <code>outdir</code>.</p></dd>


<dt>outdir</dt>
<dd><p>Directory to save TOP model posterior samples.</p></dd>


<dt>return_type</dt>
<dd><p>Type of result to return.
Options: ‘samples’(posterior samples),
‘jagsfit’ (<code>jagsfit</code> object),
or ‘samplefiles’ (file names of posterior samples).</p></dd>


<dt>quiet</dt>
<dd><p>Logical, if TRUE, suppress model fitting messages.
Otherwise, only show progress bars.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>A list of posterior samples or <code>jagsfit</code> object for each partition.</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="co"># Example to train TOP quantitative occupancy model:</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># The example below first performs 'asinh' transform to the ChIP-seq counts</span></span></span>
<span class="r-in"><span><span class="co"># in 'assembled_training_data', then runs Gibbs sampling</span></span></span>
<span class="r-in"><span><span class="co"># for each of the 10 partitions in parallel.</span></span></span>
<span class="r-in"><span><span class="co"># The following example runs 5000 iterations of Gibbs sampling in total,</span></span></span>
<span class="r-in"><span><span class="co"># including 1000 burn-ins, with 3 Markov chains, at a thinning rate of 2,</span></span></span>
<span class="r-in"><span><span class="co"># and saves the posterior samples to the 'TOP_fit' directory.</span></span></span>
<span class="r-in"><span><span class="va">all_TOP_samples</span> <span class="op">&lt;-</span> <span class="fu">fit_TOP_M5_model</span><span class="op">(</span><span class="va">assembled_training_data</span>,</span></span>
<span class="r-in"><span>                                    logistic_model <span class="op">=</span> <span class="cn">FALSE</span>,</span></span>
<span class="r-in"><span>                                    transform <span class="op">=</span> <span class="st">'asinh'</span>,</span></span>
<span class="r-in"><span>                                    n_iter <span class="op">=</span> <span class="fl">5000</span>,</span></span>
<span class="r-in"><span>                                    n_burnin <span class="op">=</span> <span class="fl">1000</span>,</span></span>
<span class="r-in"><span>                                    n_chains <span class="op">=</span> <span class="fl">3</span>,</span></span>
<span class="r-in"><span>                                    n_thin <span class="op">=</span> <span class="fl">2</span>,</span></span>
<span class="r-in"><span>                                    out_dir <span class="op">=</span> <span class="st">'TOP_fit'</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># We can also obtain the posterior samples separately for each partition,</span></span></span>
<span class="r-in"><span><span class="co"># For example, to obtain the posterior samples for partition #3 only:</span></span></span>
<span class="r-in"><span><span class="va">TOP_samples_part3</span> <span class="op">&lt;-</span> <span class="fu">fit_TOP_M5_model</span><span class="op">(</span><span class="va">assembled_training_data</span>,</span></span>
<span class="r-in"><span>                                      logistic_model <span class="op">=</span> <span class="cn">FALSE</span>,</span></span>
<span class="r-in"><span>                                      transform <span class="op">=</span> <span class="st">'asinh'</span>,</span></span>
<span class="r-in"><span>                                      partitions <span class="op">=</span> <span class="fl">3</span>,</span></span>
<span class="r-in"><span>                                      n_iter <span class="op">=</span> <span class="fl">5000</span>,</span></span>
<span class="r-in"><span>                                      n_burnin <span class="op">=</span> <span class="fl">1000</span>,</span></span>
<span class="r-in"><span>                                      n_chains <span class="op">=</span> <span class="fl">3</span>,</span></span>
<span class="r-in"><span>                                      n_thin <span class="op">=</span> <span class="fl">2</span>,</span></span>
<span class="r-in"><span>                                      out_dir <span class="op">=</span> <span class="st">'TOP_fit'</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Example to train TOP logistic (binary) model:</span></span></span>
<span class="r-in"><span><span class="va">all_TOP_samples</span> <span class="op">&lt;-</span> <span class="fu">fit_TOP_M5_model</span><span class="op">(</span><span class="va">assembled_training_data</span>,</span></span>
<span class="r-in"><span>                                    logistic_model <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>                                    n_iter <span class="op">=</span> <span class="fl">5000</span>,</span></span>
<span class="r-in"><span>                                    n_burnin <span class="op">=</span> <span class="fl">1000</span>,</span></span>
<span class="r-in"><span>                                    n_chains <span class="op">=</span> <span class="fl">3</span>,</span></span>
<span class="r-in"><span>                                    n_thin <span class="op">=</span> <span class="fl">2</span>,</span></span>
<span class="r-in"><span>                                    out_dir <span class="op">=</span> <span class="st">'TOP_fit'</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Kaixuan Luo, Jianling Zhong, Alex Hartemink.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer></div>

  


  

  </body></html>

